<!-- Search Form - Separate from data grid structure -->
<div class="admin__page-section">
    <div class="admin__page-section-title">
        <span class="title"><?= __('Search Order') ?></span>
    </div>

    <div class="admin__page-section-content">
        <div class="admin__fieldset">
            <form id="refund-search-form">
                <div class="admin__fieldset-wrapper-content">
                    <div class="admin__fieldset-section">
                        <div class="admin__field-row">
                            <!-- First Column -->
                            <div class="admin__field admin__field-medium" style="margin-top:0;">
                                <div class="admin__field-label">
                                    <label for="merchant_track_id"><?= __('Merchant Track ID') ?></label>
                                </div>
                                <div class="admin__field-control">
                                    <input type="text" id="merchant_track_id" name="merchant_track_id" class="admin__control-text" placeholder="<?= __('Enter Merchant Track ID') ?>">
                                </div>
                            </div>

                            <div class="admin__field admin__field-medium" style="margin-top:0;">
                                <div class="admin__field-label">
                                    <label for="transaction_id"><?= __('Transaction ID') ?></label>
                                </div>
                                <div class="admin__field-control">
                                    <input type="text" id="transaction_id" name="transaction_id" class="admin__control-text" placeholder="<?= __('Enter Transaction ID') ?>">
                                </div>
                            </div>
                        </div>

                        <div class="admin__field-row">
                            <div class="admin__field admin__field-medium">
                                <div class="admin__field-label">
                                    <label for="date_from"><?= __('Date From') ?></label>
                                </div>
                                <div class="admin__field-control">
                                    <input type="date" id="date_from" name="date_from" class="admin__control-text">
                                </div>
                            </div>

                            <div class="admin__field admin__field-medium" style="margin-top:0;">
                                <div class="admin__field-label">
                                    <label for="date_to"><?= __('Date To') ?></label>
                                </div>
                                <div class="admin__field-control">
                                    <input type="date" id="date_to" name="date_to" class="admin__control-text">
                                </div>
                            </div>
                        </div>

                        <div class="admin__field-row">
                            <div class="admin__field admin__field-medium">
                                <div class="admin__field-label">
                                    <label for="order_status"><?= __('Order Status') ?></label>
                                </div>
                                <div class="admin__field-control">
                                    <select id="order_status" name="order_status" class="admin__control-select">
                                        <?php foreach ($this->getOrderStatusOptions() as $value => $label): ?>
                                            <option value="<?= $value ?>"><?= $label ?></option>
                                        <?php endforeach; ?>
                                    </select>
                                </div>
                            </div>
                        </div>

                        <div class="admin__field-row">
                            <div class="admin__field">
                                <div class="admin__field-control">
                                    <button type="button" class="action-default scalable primary" id="search-button">
                                        <span><?= __('Search Orders') ?></span>
                                    </button>
                                    <button type="button" class="action-default scalable" id="clear-button">
                                        <span><?= __('Clear Form') ?></span>
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </form>
        </div>
    </div>
</div>

<!-- Results Section - Separate container -->
<div id="search-results" style="display: none; margin-top: 20px;">
    <div class="admin__page-section">
        <div class="admin__page-section-title">
            <span class="title"><?= __('Search Results') ?></span>
            <span id="results-count" style="margin-left: 20px; color: #666; font-size: 14px;"></span>
        </div>

        <div class="admin__page-section-content">
            <div class="admin__data-grid-wrap">
                <table class="data-grid" id="results-table">
                    <thead>
                        <tr>
                            <th class="data-grid-th _sortable"><?= __('ID') ?></th>
                            <th class="data-grid-th _sortable"><?= __('Order ID') ?></th>
                            <th class="data-grid-th _sortable"><?= __('Merchant Track ID') ?></th>
                            <th class="data-grid-th _sortable"><?= __('Transaction ID') ?></th>
                            <th class="data-grid-th _sortable"><?= __('Amount') ?></th>
                            <th class="data-grid-th _sortable"><?= __('Payment Status') ?></th>
                            <th class="data-grid-th _sortable"><?= __('Order Status') ?></th>
                            <th class="data-grid-th _sortable"><?= __('Refund Status') ?></th>
                            <th class="data-grid-th _sortable"><?= __('Payment Method') ?></th>
                            <th class="data-grid-th _sortable"><?= __('Created At') ?></th>
                            <th class="data-grid-th"><?= __('Actions') ?></th>
                        </tr>
                    </thead>
                    <tbody id="results-body">
                        <!-- Results will be populated here -->
                    </tbody>
                </table>
            </div>
        </div>
    </div>
</div>

<!-- Loading indicator -->
<div id="loading-indicator" style="display: none; text-align: center; padding: 20px;">
    <div class="admin__data-grid-loading-mask">
        <div class="spinner">
            <span></span><span></span><span></span><span></span>
            <span></span><span></span><span></span><span></span>
        </div>
    </div>
    <p><?= __('Searching payments...') ?></p>
</div>

<style>
    /* Custom CSS to ensure form stays visible */
    .admin__fieldset {
        background: #fff;
        border: 1px solid #e3e3e3;
        margin-bottom: 2rem;
        padding: 2rem;
    }

    .admin__field-row {
        display: flex;
        gap: 2rem;
        margin-bottom: 1.5rem;
    }

    .admin__field-medium {
        flex: 1;
        min-width: 0;
    }

    .admin__field-control input,
    .admin__field-control select {
        width: 100%;
    }

    #search-results {
        animation: fadeIn 0.3s ease-in;
    }

    @keyframes fadeIn {
        from {
            opacity: 0;
        }

        to {
            opacity: 1;
        }
    }

    .spinner {
        display: inline-block;
        position: relative;
        width: 80px;
        height: 80px;
    }

    .spinner span {
        position: absolute;
        top: 33px;
        width: 13px;
        height: 13px;
        border-radius: 50%;
        background: #007cba;
        animation: spinner 1.2s linear infinite;
    }

    .spinner span:nth-child(1) {
        transform: rotate(0deg);
        animation-delay: -1.1s;
    }

    .spinner span:nth-child(2) {
        transform: rotate(30deg);
        animation-delay: -1s;
    }

    .spinner span:nth-child(3) {
        transform: rotate(60deg);
        animation-delay: -0.9s;
    }

    .spinner span:nth-child(4) {
        transform: rotate(90deg);
        animation-delay: -0.8s;
    }

    .spinner span:nth-child(5) {
        transform: rotate(120deg);
        animation-delay: -0.7s;
    }

    .spinner span:nth-child(6) {
        transform: rotate(150deg);
        animation-delay: -0.6s;
    }

    .spinner span:nth-child(7) {
        transform: rotate(180deg);
        animation-delay: -0.5s;
    }

    .spinner span:nth-child(8) {
        transform: rotate(210deg);
        animation-delay: -0.4s;
    }

    @keyframes spinner {

        0%,
        39%,
        100% {
            opacity: 0;
        }

        40% {
            opacity: 1;
        }
    }
</style>

<script type="text/x-magento-init">
    {
    "*": {
        "Bede_PaymentGateway/js/refund-search": {
            "searchUrl": "<?= $block->getSearchUrl() ?>",
            "refundUrl": "<?= $block->getRefundUrl() ?>",
            "requestRefundUrl": "<?= $block->getRequestRefundUrl() ?>"
        }
    }
}
</script>